FROM golang:1.24.3-alpine

RUN apk add --no-cache \
    ca-certificates \
    tzdata \
    netcat-openbsd \
    curl \
    bind-tools \
    git

WORKDIR /app

# Copy go.mod and go.sum first for better layer caching
COPY go.mod go.sum ./

# Download dependencies - this layer will be cached unless go.mod/go.sum changes
RUN go mod download

# Copy the rest of the source code
COPY . .

CMD ["sh", "-c", "cd /app && go test -v ./tests/integration_test.go -tags=integration"]
